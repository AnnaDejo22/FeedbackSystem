@inject HttpClient Http
@using System.ComponentModel.DataAnnotations
@using FeedbackSystem.Contracts.DTO 

<EditForm Model="feedback" OnValidSubmit="SubmitFeedback">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label>Name:</label>
        <InputText @bind-Value="feedback.UserName" />
        <ValidationMessage For="@(() => feedback.UserName)" />
    </div>

    <div>
        <label>Feedback:</label>
        <InputTextArea @bind-Value="feedback.FeedbackText" />
        <ValidationMessage For="@(() => feedback.FeedbackText)" />
    </div>

    <div>
        <label>Rating (1-5):</label>
        <InputNumber @bind-Value="feedback.Rating" min="1" max="5" />
        <ValidationMessage For="@(() => feedback.Rating)" />
    </div>

    <button type="submit">Submit</button>
</EditForm>

@if (!string.IsNullOrEmpty(message))
{
    <p>@message</p>
}

@code {
    private FeedbackDTO feedback = new FeedbackDTO
    {
        UserName = string.Empty,
        FeedbackText = string.Empty,
        Rating = 1
    };

    private string message = string.Empty;

    private async Task SubmitFeedback()
    {
        try
        {
            var response = await Http.PostAsJsonAsync("api/feedback", feedback);

            if (response.IsSuccessStatusCode)
            {
                message = "Feedback submitted successfully!";

                // Reset form
                feedback = new FeedbackDTO
                {
                    UserName = string.Empty,
                    FeedbackText = string.Empty,
                    Rating = 1
                };
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                message = $"Failed to submit feedback: {error}";
            }
        }
        catch (Exception ex)
        {
            // Likely network/CORS error
            message = $"Error submitting feedback: {ex.Message}";
        }
    }
}
